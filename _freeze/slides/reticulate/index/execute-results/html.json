{
  "hash": "7c61c695d4eb171831c6d2432412d837",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Reticulate\"\nauthor: \"Nina Norgren\"\nimage: \"assets/featured.jpg\"\nformat: revealjs\n---\n\n\n## Packages {visibility=\"hidden\"}\n\n\n::: {.cell}\n\n:::\n\n\n## Learning outcomes\n\n<br>\n\nIn this session we will learn to:\n\n- Understand the concepts needed for running Python in R\n- Understand the different object classes in Python and their equivalent in R\n- Apply our knowledge to:\n  - Import Python functions into R\n  - Use R objects as input to Python functions\n  - Translate between Python and R objects\n\n## Introduction\n\n<br><br>\n[**R versus Python**]{.center .larger}\n[The ultimate fight!]{.center .largest}\n\n. . .\n\n<br><br><br>\n[Not anymore!]{.center .largest}\n\n## Introducing reticulate\n\n- Combine Python and R code\n- Use R classes in Python functions and vice versa\n- Import Python functions into R code and run from R\n- Add Python code chunks to markdown documents\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(reticulate)\n```\n:::\n\n\n## Importing Python modules\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatetime <- import(\"datetime\")\ntodays_r_date <- datetime$datetime$now()\n```\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntodays_r_date\nclass(todays_r_date)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-02-20 17:15:04 UTC\"\n[1] \"POSIXct\" \"POSIXt\" \n```\n\n\n:::\n:::\n\n\n. . .\n\nObjects are automatically converted to R types, unless otherwise specified\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatetime <- import(\"datetime\", convert = FALSE)\ntodays_py_date <- datetime$datetime$now()\n```\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntodays_py_date\nclass(todays_py_date)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ndatetime.datetime(2024, 2, 20, 17, 15, 4, 254836)\n[1] \"datetime.datetime\"     \"datetime.date\"         \"python.builtin.object\"\n```\n\n\n:::\n:::\n\n\n## Importing built-in Python functions\n\nAccess Python's built-in functions directly in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuiltins <- import_builtins()\nr_vec <- c(1, 5, 3, 4, 2, 2, 3, 2)\nstr(r_vec)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n num [1:8] 1 5 3 4 2 2 3 2\n```\n\n\n:::\n:::\n\n\n`r_vec` is an R object.\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuiltins$len(r_vec); builtins$max(r_vec)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 8\n[1] 5\n```\n\n\n:::\n:::\n\n\nPython built-in functions still working on R objects\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmax(r_vec)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5\n```\n\n\n:::\n:::\n\n\nNormal R way\n\n## Sourcing scripts\n\nImport your own python functions for use in R. File `python_functions.py`:\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndef add(x, y):\n  return x + y\n```\n:::\n\n\n. . .\n\nR code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource_python(\"python_functions.py\")\nclass(4)\nres <- add(4,5)\nres\nclass(res)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"numeric\"\n[1] 9\n[1] \"numeric\"\n```\n\n\n:::\n:::\n\n\n. . .\n\nType `numeric` in and type `numeric` out. But what happens in between?\n\n## Sourcing scripts\n\nBut what happens in between?\n\nFile `python_functions.py`:\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndef add_with_print(x, y):\n  print(x, 'is of the python type ', type(x))\n  return x + y\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres2 <- add_with_print(4,5)\npy_capture_output(add_with_print(4,5))\nstr(res2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n4.0 is of the python type  <class 'float'>\n[1] \"4.0 is of the python type  <class 'float'>\\n\\n\"\n num 9\n```\n\n\n:::\n:::\n\n\n## Execute Python code\n\nRun python string:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npy_run_string(\"result = [1,2,3]*2\")\npy$result\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1 2 3 1 2 3\n```\n\n\n:::\n:::\n\n\nAll objects created by python are accessible using the `py` object exported by **reticulate**\n\n## Execute Python code\n\nRun python script `my_python_script.py`:\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndef add(x, y):\n  return x + y\n\ndef multiply_by_3(x):\n  return x*3\n\ndef run_all():\n  x = 5\n  y = 8\n  added = add(x, y)\n  final = multiply_by_3(added)\n  return final\n\nfinal = run_all()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npy_run_file(\"my_python_script.py\")\npy$final\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 39\n```\n\n\n:::\n:::\n\n\n## Python in R Markdown\n\nIn R Markdown, it is possible to mix in Python chunks:\n\n````\n```{{python}}\nimport pandas as pd\n\nmovies = get_all_movies()\nprint(type(movies))\n```\n````\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n<class 'pandas.core.frame.DataFrame'>\n```\n\n\n:::\n:::\n\n\n## Python in R Markdown\n\nAccess the movie object using the `py` object, which will convert movies to an R object:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmovies_r <- py$movies\nmovies_r <- as_tibble(movies_r)\nsubset <- movies_r %>% select(5:6, 8:10)\n```\n:::\n\n\n## Python in R Markdown\n\nAccess the movie object using the `py` object, which will convert movies to an R object:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmovies_r <- py$movies\nmovies_r <- as_tibble(movies_r)\nsubset <- movies_r %>% select(5:6, 8:10)\nknitr::kable(subset[1:7,],'html')\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> originalTitle </th>\n   <th style=\"text-align:left;\"> startYear </th>\n   <th style=\"text-align:right;\"> runtimeMinutes </th>\n   <th style=\"text-align:left;\"> genres </th>\n   <th style=\"text-align:right;\"> averageRating </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Kate &amp; Leopold </td>\n   <td style=\"text-align:left;\"> 2001 </td>\n   <td style=\"text-align:right;\"> 118 </td>\n   <td style=\"text-align:left;\"> Comedy,Fantasy,Romance </td>\n   <td style=\"text-align:right;\"> 6.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> The Brain That Wouldn't Die </td>\n   <td style=\"text-align:left;\"> 1962 </td>\n   <td style=\"text-align:right;\"> 82 </td>\n   <td style=\"text-align:left;\"> Horror,Sci-Fi </td>\n   <td style=\"text-align:right;\"> 4.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> The Fugitive Kind </td>\n   <td style=\"text-align:left;\"> 1960 </td>\n   <td style=\"text-align:right;\"> 119 </td>\n   <td style=\"text-align:left;\"> Drama,Romance </td>\n   <td style=\"text-align:right;\"> 7.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Les yeux sans visage </td>\n   <td style=\"text-align:left;\"> 1960 </td>\n   <td style=\"text-align:right;\"> 90 </td>\n   <td style=\"text-align:left;\"> Drama,Horror </td>\n   <td style=\"text-align:right;\"> 7.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> À bout de souffle </td>\n   <td style=\"text-align:left;\"> 1960 </td>\n   <td style=\"text-align:right;\"> 90 </td>\n   <td style=\"text-align:left;\"> Crime,Drama </td>\n   <td style=\"text-align:right;\"> 7.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 13 Ghosts </td>\n   <td style=\"text-align:left;\"> 1960 </td>\n   <td style=\"text-align:right;\"> 85 </td>\n   <td style=\"text-align:left;\"> Horror,Mystery </td>\n   <td style=\"text-align:right;\"> 6.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> The Alamo </td>\n   <td style=\"text-align:left;\"> 1960 </td>\n   <td style=\"text-align:right;\"> 162 </td>\n   <td style=\"text-align:left;\"> Adventure,Drama,History </td>\n   <td style=\"text-align:right;\"> 6.8 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Python in R Markdown\n\nContinue working with the now converted R object in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(movies_r, aes(x=startYear)) + geom_bar() + \n                                     theme(axis.text.x = element_text(angle = 90)) +\n                                     ggtitle('Number of movies per year')\n```\n:::\n\n\n## Python in R Markdown\n\nContinue working with the now converted R object in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(movies_r, aes(x=startYear)) + geom_bar() + \n                                     theme(axis.text.x = element_text(angle = 90)) +\n                                     ggtitle('Number of movies per year')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-21-1.png){width=960}\n:::\n:::\n\n\n## Type conversions\n\nWhen calling python code from R, R data types are converted to Python types, and vice versa, when values are returned from Python to R they are converted back to R types.\n\n[**Conversion table**]{.large}\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> R </th>\n   <th style=\"text-align:left;\"> Python </th>\n   <th style=\"text-align:left;\"> Examples </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Single-element vector </td>\n   <td style=\"text-align:left;\"> Scalar </td>\n   <td style=\"text-align:left;\"> 1   , 1L  , TRUE, foo </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Multi-element vector </td>\n   <td style=\"text-align:left;\"> List </td>\n   <td style=\"text-align:left;\"> c(1.0, 2.0, 3.0), c(1L, 2L, 3L) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> List of multiple types </td>\n   <td style=\"text-align:left;\"> Tuple </td>\n   <td style=\"text-align:left;\"> list(1L, TRUE, &quot;foo&quot;) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Named list </td>\n   <td style=\"text-align:left;\"> Dict </td>\n   <td style=\"text-align:left;\"> list(a = 1L, b = 2.0), dict(x = x_data) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Matrix/Array </td>\n   <td style=\"text-align:left;\"> NumPy ndarray </td>\n   <td style=\"text-align:left;\"> matrix(c(1,2,3,4), nrow=2, ncol=2) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Data Frame </td>\n   <td style=\"text-align:left;\"> Pandas DataFrame </td>\n   <td style=\"text-align:left;\"> data.frame(x = c(1,2,3), y = c(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;)) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Function </td>\n   <td style=\"text-align:left;\"> Python function </td>\n   <td style=\"text-align:left;\"> function(x) x +1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Raw </td>\n   <td style=\"text-align:left;\"> Python bytearray </td>\n   <td style=\"text-align:left;\"> as.raw(c(1:10)) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> NULL, TRUE, FALSE </td>\n   <td style=\"text-align:left;\"> None, True, False </td>\n   <td style=\"text-align:left;\"> NULL, TRUE, FALSE </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Type conversions\n\n`python_functions.py`:\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndef check_python_type(x):\n  print(type(x))\n  return x\n```\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource_python(\"python_functions.py\")\n\nr_var <- matrix(c(1,2,3,4),nrow=2, ncol=2)\nclass(r_var)\npy_capture_output(check_python_type(r_var))\nr_var2 <- check_python_type(r_var)\nclass(r_var2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"matrix\" \"array\" \n[1] \"<class 'numpy.ndarray'>\\n\\n\"\n<class 'numpy.ndarray'>\n[1] \"matrix\" \"array\" \n```\n\n\n:::\n:::\n\n\n## Type conversions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource_python(\"python_functions.py\", convert=FALSE)\n\nr_var <- matrix(c(1,2,3,4),nrow=2, ncol=2)\nclass(r_var)\npy_capture_output(check_python_type(r_var))\nr_var2 <- check_python_type(r_var)\nclass(r_var2)\nr_var3 <- py_to_r(r_var2)\nclass(r_var3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"matrix\" \"array\" \n[1] \"<class 'numpy.ndarray'>\\n\\n\"\n<class 'numpy.ndarray'>\n[1] \"numpy.ndarray\"         \"python.builtin.object\"\n[1] \"matrix\" \"array\" \n```\n\n\n:::\n:::\n\n\n## Type conversions\n\n- `42` in R is a floating point number. In Python it is an integer\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(42)\ncheck_python_type(42)\npy_capture_output(check_python_type(42))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n num 42\n<class 'float'>\n42.0\n[1] \"<class 'float'>\\n\\n\"\n```\n\n\n:::\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(42L)\ncheck_python_type(42L)\npy_capture_output(check_python_type(42L))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n int 42\n<class 'int'>\n42\n[1] \"<class 'int'>\\n\\n\"\n```\n\n\n:::\n:::\n\n\n## Type conversions\n\n- List conversions of single element vectors, automatically translated to Python scalar\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(c(24))\ncheck_python_type(c(24))\npy_capture_output(check_python_type(c(24)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n num 24\n<class 'float'>\n24.0\n[1] \"<class 'float'>\\n\\n\"\n```\n\n\n:::\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(list(24))\ncheck_python_type(list(24))\npy_capture_output(check_python_type(list(24)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 1\n $ : num 24\n<class 'list'>\n[24.0]\n[1] \"<class 'list'>\\n\\n\"\n```\n\n\n:::\n:::\n\n\n## {background-image=\"/assets/images/cover.jpg\"}\n\n### Thank you! Questions?\n\n[{{< meta current_year >}} • [SciLifeLab](https://www.scilifelab.se/) • [NBIS](https://nbis.se/) • [RaukR](https://nbisweden.github.io/raukr-2024)]{.smaller}\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}