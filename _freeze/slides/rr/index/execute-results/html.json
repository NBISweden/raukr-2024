{
  "hash": "fb57117da6e026e9691a8e2fb9ea8d76",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Reproducible research in R\"\nauthor: \"Roy Francis\"\nimage: \"assets/featured.jpg\"\nformat: revealjs\n---\n\n::: {.cell}\n\n:::\n\n\n## Topics\n\n- Reproducibility\n- Environment\n- RStudio\n\n## What's all the fuss about?\n\n![](assets/nature-reproducibility.jpg){width=\"70%\"}  \n[[https://www.nature.com/collections/prbfkwmwvz/](https://www.nature.com/collections/prbfkwmwvz/)]{.smaller}\n\n![](assets/nature-reproducibility-2.jpg){width=\"70%\"}  \n[[https://www.nature.com/news/1-500-scientists-lift-the-lid-on-reproducibility-1.19970](https://www.nature.com/news/1-500-scientists-lift-the-lid-on-reproducibility-1.19970)]{.smaller}\n\n::: {.notes}\n\nA large percentage of research is not reproducible by other researchers or by the original researchers themselves. This concern has been lately addressed by several high profile journals.\n\n:::\n\n##\n\n![](assets/nature-rr-pie.jpg){width=\"45%\"}  \n![](assets/nature-rr-bar.jpg){width=\"65%\"} \n\n## What is reproducibility?\n\n> \"reproducibility refers to the **ability** of a researcher **to duplicate the results** of a prior study using the same materials as were used by the original investigator. That is, a second researcher might use the same raw data to build the same analysis files and implement the same statistical analysis in an attempt to yield the same results…\"\n\n[K. Bollen, J. T. Cacioppo, R. Kaplan, J. Krosnick, J. L. Olds, Social, Behavioral, and Economic Sciences Perspectives on Robust and Reliable Science (National Science Foundation, Arlington, VA, 2015)]{.smaller}\n\n[Goodman, S. N., Fanelli, D., & Ioannidis, J. P. A. (2016). What does research reproducibility mean? Science Translational Medicine, 8(341), 341ps12–341ps12. http://doi.org/10.1126/scitranslmed.aaf5027]{.smaller}\n\n## Reproducibility in R\n\n![](assets/turingway-reproduciblematrix.jpeg){width=\"85%\"} \n\n.[from Turing way (<https://the-turing-way.netlify.app/reproducible-research/overview/overview-definitions.html>)]{.smaller}\n\n## Typical workflow\n\n1. Get data\n2. Clean, transform data in spreadsheet\n3. Copy-paste, copy-paste, ...\n4. Run analysis & make figures\n5. Write up a report attaching the figures\n6. Need to modify the source data/analysis\n7. Go back to step 2, Repeat\n8. (after a couple of months) Need to fix the figures\n9. Ask to myself which data I'm supposed to use now? (`data-final3` or `data-refined2`)\n10. Realize the number of samples didn't match\n11. Back to step 2, try to remember why some data was modified manually before\n\n--\n\n- (a couple of years later) \"I got these figures from you. Could you modify them?\"\n[![](assets/picard.jpg)]{width=\"30%\"}\n\n::: {.notes}\n\nManually handling workflow is hard to reproduce because it is hard to know the exact step carried out. A programmatic workflow allows full transparency to the exact steps followed.\n\n:::\n\n## Benefits of reproducibility\n\n\n- Get the same results as before\n- Rerunning workflow\n- Additional data/New data\n- Returning to a project\n- Transferring projects\n- Collaborative work\n- Easy to make changes\n- Eliminate copy-paste errors\n\n::: {.notes}\n\nA reproducible workflow allows a lot of convenience. \n\n- It's easy to automate re-running of analysis when earlier steps have changed such as new input data, code or assumptions. \n- Useful for an investigator returning to an analyses after a period of time.\n- Useful when a project is transferred to a new investigator.\n- Useful when working collaboratively.\n- When you are asked to modify or change a parameter.\n\n:::\n\n## Solutions\n\n![](assets/rr-solutions.jpg)\n\n- Containerised computing environment - *eg: Singularity, Docker*\n- Workflow manager - *eg: Snakemake, Nextflow*\n- Package and environment manager - *eg: renv, Conda*\n- Track edits and collaborate coding - *eg: Git*\n- Share and track code - *eg: GitHub, Bitbucket*\n- Notebooks to document ongoing analyses - *eg: Jupyter*\n- Analyze and generate reports - *eg: R Markdown*\n\nA NBIS course of [**Tools for reproducible research**](https://nbis-reproducible-research.readthedocs.io/en/latest/)\n\n::: {.notes}\n\nReproducible projects can be performed at different levels. Reproducibility is the ability for a work to be reproduced by an independently working third-party.\n\n:::\n\n## Steps to reproducibility\n\n- Avoid manual steps\n- Documents containing analysis, code and results\n- Note the software environment\n- Self-contained portable project\n- Results directly linked to code\n- Contextual narrative to why a certain step was performed\n- Version control of documents\n- Keep the original data intact (read-only) with descriptions incl. how the data was obtained\n\n::: {.notes}\n\nReproducible programming is not an R specific issue. R offers a set of tools and an environment that is conducive to reproducible research.\n\n:::\n\n## Environment\n\n- Not about `environment()`\n- Software environment around your code\n- Operating system (Windows, Mac, Linux, ...)\n- A particular version of R/Python\n- Loaded package versions\n\n## Software for environment management\n\n- Operating system - *Singularity*, *Docker*\n\n- R/Python - *Conda*\n\n- Loaded package versions - *`renv`* package\n\n## `renv` package\n\n- **R env**ironment management package\n\n- It helps our individual projects **isolated** so **portable**, and **reproducible**\n\n- Local library of R packages\n\n- Install `renv` package from CRAN or Conda\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"renv\")\nconda install -c conda-forge r-renv \n```\n:::\n\n\n- Initialize local R environment using `renv`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrenv::init()\n```\n:::\n\n\n- Save the local library state\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrenv::snapshot()\n```\n:::\n\n\n- Restore the local library\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrenv::restore()\n```\n:::\n\n\n[https://kevinushey-2020-rstudio-conf.netlify.app/slides.html]{.smaller}\n\n## Install R packages\n\n- Use `renv::install` as below\n- From CRAN : `renv::install(\"`*package name*`\")` (e.g. `renv::install(\"dplyr\")`)\n- From Bioconductor : `renv::install(\"bioc::`*package name*`\")` \n(e.g `renv::install(\"bioc::Biobase\")`)\n- From GitHub : `renv::install(\"`*user name*`/`*repository*`\")` (e.g. `renv::install(\"StoreyLab/qvalue\")`) \n- From GitLab/Bitbucket : `renv::install(\"[gitlab|bitbucket]::`*user name*`/`*repository*`\")`\n\n## RStudio • IDE\n\n![](assets/rstudio.jpg){width=\"90%\"}\n\n- Code completion & Syntax highlighting (for many languages)\n- R Notebook\n- Debugging\n- Useful GUI elements\n- Multiple sessions can be opened in parallel\n\n## RStudio • Project\n\n**Create a new project**\n\n![](assets/new-project.gif){width=\"90%\"}\n\n- Portable project (.Rproj)\n- Dynamic reports\n- Version control (git)\n- Package management (`renv`)\n\n## Project Structure\n\n```\nproject_name/\n+-- data/\n|   +-- gene_counts.txt\n|   +-- metadata.txt\n+-- results/\n|   +-- gene_filtered_counts.txt\n|   +-- gene_vst_counts.txt\n+-- images/\n|   +-- exp-setup.jpg\n+-- scripts/\n|   +-- bash/\n|   |   +-- fastqc.sh\n|   |   +-- trim_adapters.sh\n|   |   +-- mapping.sh\n|   +-- r/\n|       +-- qc.R\n|       +-- functions.R\n|       +-- dge.R\n+-- report/\n    +-- report.Rmd\n```\n\n- Organise data, scripts and results sensibly\n- Keep projects self contained\n- Use relative links\n\n::: {.notes}\n\nTry to organize all material related to a project in a common directory. Organise the directory in a sensible manner. Use relative links to refer to files. Consider raw as read-only content.\n\n:::\n\n## Publishing\n\n- Quarto\n- Markdown\n- Rmarkdown\n\n## RStudio • Project with Git\n\n**Create a new project with version control**\n![](assets/rstudio_git_new.gif)\n\n- Version control : keep old versions and who/when files modified for what\n- A repository in GitHub/Bitbucket\n\n## RStudio • Git commit\n\n**Log a set of changes using Git**\n![](assets/rstudio_git_push.gif)\n\n::: {.notes}\n\nHow to Git commit using RStudio\n\n:::\n\n## Acknowledgements\n\n- [**Reproducible Research in R and RStudio**](https://www.slideshare.net/SusanJohnston3/reproducible-research-in-r-and-r-studio) - Susan Johnston  \n- [**New Tools for Reproducible Research with R**](https://slides.yihui.name/2012-knitr-RStudio.html) - JJ Allaire and Yihui Xie  \n- [**Reproducible research with R**](http://www.hafro.is/~einarhj/education/tcrenv2016/pre/r-markdown.pdf) - Bjarki Thor Elvarsson and Einar Hjorleifsson  \n- [**Reproducible Research Workshop**](http://www.geo.uzh.ch/microsite/reproducible_research/post/rr-r-publication/) - University of Zurich  \n- RStudio [learning](https://www.rstudio.com/online-learning/)\n\n## {background-image=\"/assets/images/cover.jpg\"}\n\n### Thank you! Questions?\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n         _                  \nplatform x86_64-pc-linux-gnu\nos       linux-gnu          \nmajor    4                  \nminor    3.2                \n```\n\n\n:::\n:::\n\n\n[{{< meta current_year >}} • [SciLifeLab](https://www.scilifelab.se/) • [NBIS](https://nbis.se/) • [RaukR](https://nbisweden.github.io/raukr-2024)]{.smaller}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}